<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

  <!-- Add references to the Azure Maps Map control JavaScript and CSS files. -->
  <link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css" type="text/css">
  <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js"></script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" type="text/css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

  <!-- Add a reference to the Azure Maps Services Module JavaScript file. -->
  <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas-service.min.js"></script>
  <script src="azure-maps-geolocation.min.js" type="text/javascript"></script>  

  <title>Cosmic-Azlearn</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .match {
      background-color: var(--color-bg-primary);
      display: flex;
      flex-direction: column;
      min-width: 600px;
      border-radius: 10px;
      box-shadow: 0 0 2px 0 rgba(48, 48, 48, 0.1), 0 4px 4px 0 rgba(48, 48, 48, 0.1);
    }

    .match-header {
      display: flex;
      padding: 16px;
      border-bottom: 2px solid rgba(48, 48, 48, 0.1);
    }

    .match-status {
      background-color: var(--color-bg-alert);
      color: var(--color-text-alert);
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      display: flex;
      align-items: center;
      line-height: 1;
      margin-right: auto;
    }

    .match-status:before {
      content: "";
      display: block;
      width: 6px;
      height: 6px;
      background-color: currentcolor;
      border-radius: 50%;
      margin-right: 8px;
    }

    .match-tournament {
      display: flex;
      align-items: center;
      font-weight: 600;
    }

    .match-tournament img {
      width: 20px;
      margin-right: 12px;
    }

    .match-actions {
      display: flex;
      margin-left: auto;
    }

    .btn-icon {
      border: none;
      background-color: transparent;
      color: var(--color-text-icon);
      display: flex;
      align-items: center;
      justify-content: center;
    }


    .timer {
      font-family: sans-serif;
      display: inline-block;
      padding: 0px 0px;
      border-radius: 30px;
      background: white;
    }

    .timer__part {
      font-size: 36px;
      font-weight: bold;
    }

    .timer__btn {
      width: 50px;
      height: 50px;
      margin-left: 16px;
      border-radius: 50%;
      border: none;
      color: white;
      background: #8208e6;
      cursor: pointer;
    }

    .timer__btn--start {
      background: #00b84c;
    }

    .timer__btn--stop {
      background: #ff0256;
    }


    .leaderboard {      
      margin: 5rem auto;
      border-radius: 1rem;
      box-shadow: 2px 2px 16px 1px #aaa;
      font-family: "sofia-pro", sans-serif;
    }

    a {
      text-decoration: none !important;
      color: inherit;
    }

    header {
      background-color: var(--blue);
      color: white;      
      border-top-left-radius: 1rem;
      border-top-right-radius: 1rem;
      height: 7rem;
      position: relative;
    }

    h1 {
      font-size: 1rem;
      line-height: 3rem;
      position: absolute;
      font-weight: bolder;
      margin-left: 3rem;
      top: 1rem;
    }

    nav {
      width: 100%;
      position: absolute;
      bottom: 0;
      font-size: 0.9rem;
    }

    nav a {
      padding-top: 1rem;
      padding-bottom: 0.75rem;
      display: inline-block;
      font-weight: bold;
    }

    nav a.active {
      border-bottom: 4px solid #f0a900;
    }

    nav a:first-child {
      margin-left: 3rem;
    }

    nav a+a {
      margin-left: 1rem;
    }

    table {
      background-color: white;
      color: black;
      width: 100%;
      border-collapse: collapse;
      border-bottom-left-radius: 1rem;
      border-bottom-right-radius: 1rem;
      overflow: hidden;
    }

    thead {
      font-size: 0.7rem;
      color: #555;
      text-transform: uppercase;
    }

    tbody .nick {
      color: black;
      font-weight: bold;
      font-size: 0.9rem;
    }

    tbody tr:nth-child(2n) {
      background-color: var(--light);
    }

    .nick {
      text-align: left;
    }

    .rank,
    .sp,
    .kd {
      text-align: right;
    }

    .rank {
      width: 4ch;
      padding-left: 1rem;
    }

    .sp,
    .kd {
      width: 8ch;
    }

    th {
      padding: 1.5rem 1rem 0.5rem;
    }

    td {
      padding: 1rem 1rem;
    }

    /* #1f232c */

    .todoContainer {
      width: 100%;      
    }

    .check {
      flex-basis: 90px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .check-mark {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 2px solid hsl(237, 14%, 26%);
      transition: all 0.25s;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .check-mark img {
      visibility: hidden;
    }

    .check-mark.checked img,
    .check-mark:hover img {
      visibility: visible;
    }

    .check-mark:hover {
      border-color: linear-gradient(135deg, #55DDFF 0%, #C058F3 100%);
      background: var(--blue);
    }

    .check-mark.checked {
      background-color: pink;
      background: var(--blue);
    }

    .todo-text.checked {
      text-decoration: line-through;
      color: black;
      font-family: "sofia-pro", sans-serif;
      font-weight: 400;
      font-size: 16px;
    }

    .todo-text {
      display: flex;
      align-items: center;
      font-size: 16px;
      color: black;
      font-family: "sofia-pro", sans-serif;
      font-weight: 400;
    }

    .todo-item {
      width: 100%;
      height: 70px;
      background-color: white;
      display: flex;
      border-bottom: 1px solid white;
      cursor: pointer;
      font-family: "sofia-pro", sans-serif;
      font-weight: 400;
      font-size: 16px;
      transition: all .25s ease;
      transition-property: box-shadow, transform, border-color;
    }

    .todo-items-wrapper {
      margin-top: 30px;
      border-radius: 6px;
      overflow: auto;
      height: 220px;
      font-size: 16px;
      background-color: white;
      font-family: "sofia-pro", sans-serif;
      font-weight: 400;
      box-shadow: 0px 2px 30px 0px rgba(0, 0, 0, 0.4);
      margin-bottom: 30px;
    }

    .todo-items-info {
      width: 100%;
      height: 60px;
      font-family: "sofia-pro", sans-serif;
      font-weight: 400;
      background-color: var(--blue);
      display: flex;
      align-items: center;
      font-size: 16px;
      color: white;
      padding-left: 30px;
      display: flex;
      justify-content: space-between;
      padding-right: 30px;
    }

    .items-statuses {
      display: flex;
      justify-content: center;
    }

    .items-statuses span {
      padding: 0 4px;
      cursor: pointer;
    }

    .items-clear {
      cursor: pointer;
      text-align: end;
    }

    .items-statuses span:hover,
    .items-clear:hover {
      color: hsl(220, 98%, 61%);
    }

    .items-statuses .active {
      color: hsl(220, 98%, 61%);
    }

    .todo-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 0px 7px 0px hsl(235, 21%, 11%);
      border-color: hsl(235, 24%, 19%);
    }

    #chatView {
      width: 100vw;
    }

    #globeView {
      width: 100vw;
      height: calc(60vh - 3.5rem);
    }

    body {
      font-size: 1.2vw;
    }

    span.blink {
      display: block;
      width: 15px;
      height: 15px;

      background-color: #0fcc45;
      opacity: 0.7;
      border-radius: 50%;

      animation: blink 1s linear infinite;
    }

    textarea {
      width: 100%;
      height: 100%;
      -webkit-box-sizing: border-box;
      /* Safari/Chrome, other WebKit */
      -moz-box-sizing: border-box;
      /* Firefox, other Gecko */
      box-sizing: border-box;
      /* Opera/IE 8+ */
    }

    @keyframes blink {
      100% {
        transform: scale(2, 2);
        opacity: 0;
      }
    }

    .pin {
      width: 30px;
      height: 30px;
      border-radius: 50% 50% 50% 0;
      background: #00cae9;
      position: absolute;
      transform: rotate(-45deg);
      left: 50%;
      top: 50%;
      margin: -20px 0 0 -20px;
    }

    .pin:after {
      content: "";
      width: 14px;
      height: 14px;
      margin: 8px 0 0 8px;
      background: #e6e6e6;
      position: absolute;
      border-radius: 50%;
    }

    .bounce {
      animation-name: bounce;
      animation-fill-mode: both;
      animation-duration: 1s;
    }

    .pulse {
      background: #d6d4d4;
      border-radius: 50%;
      height: 14px;
      width: 14px;
      position: absolute;
      left: 50%;
      top: 50%;
      margin: 11px 0px 0px -12px;
      transform: rotateX(55deg);
      z-index: -2;
    }

    .pulse:after {
      content: "";
      border-radius: 50%;
      height: 40px;
      width: 40px;
      position: absolute;
      margin: -13px 0 0 -13px;
      animation: pulsate 1s ease-out;
      animation-iteration-count: infinite;
      opacity: 0;
      box-shadow: 0 0 1px 2px #00cae9;
      animation-delay: 1.1s;
    }

    @keyframes pulsate {
      0% {
        transform: scale(0.1, 0.1);
        opacity: 0;
      }

      50% {
        opacity: 1;
      }

      100% {
        transform: scale(1.2, 1.2);
        opacity: 0;
      }
    }

    @keyframes bounce {
      0% {
        opacity: 0;
        transform: translateY(-2000px) rotate(-45deg);
      }

      60% {
        opacity: 1;
        transform: translateY(30px) rotate(-45deg);
      }

      80% {
        transform: translateY(-10px) rotate(-45deg);
      }

      100% {
        transform: translateY(0) rotate(-45deg);
      }
    }

    :root {
      --white: #fff;
      --black: #000;
      --bg: #f8f8f8;
      --grey: #999;
      --dark: #1a1a1a;
      --light: #e6e6e6;
      --wrapper: 1000px;
      --blue: #00b0ff;
      --color-text-primary: #1c2a38;
      --color-text-secondary: #8A8F98;
      --color-text-alert: #d72641;
      --color-text-icon: #dbdade;
      --color-bg-primary: #fff;
      --color-bg-secondary: #f3f5f9;
      --color-bg-alert: #fdeaec;
      --color-theme-primary: #623ce6;
    }

    ul {
      list-style-type: none;
    }

    .wrapper {
      position: relative;
      left: 10%;
      width: var(--wrapper);
      height: 800px;
      transform: translate(-50%, 0);
    }

    .container {
      position: relative;
      top: 50%;
      left: 70%;
      width: 90%;
      height: 75%;
      background-color: var(--white);
      transform: translate(-50%, -50%);
    }

    .container .left {
      overflow-y: scroll;
      float: left;
      width: 37.6%;
      height: 100%;
      border: 1px solid var(--light);
      background-color: var(--white);
    }

    .container .left .top {
      position: relative;
      width: 100%;
      height: 96px;
      padding: 29px;
    }

    .container .left .top:after {
      position: absolute;
      bottom: 0;
      left: 50%;
      display: block;
      width: 80%;
      height: 1px;
      content: "";
      background-color: var(--light);
      transform: translate(-50%, 0);
    }

    .container .left input {
      float: left;
      width: 188px;
      height: 42px;
      padding: 0 15px;
      border: 1px solid var(--light);
      background-color: #eceff1;
      border-radius: 21px;
      font-family: "sofia-pro", sans-serif;
      font-weight: 400;
    }

    .container .left input:focus {
      outline: none;
    }

    .container .left a.search {
      display: block;
      float: left;
      width: 42px;
      height: 42px;
      margin-left: 10px;
      border: 1px solid var(--light);
      background-color: var(--blue);
      background-image: url("https://s3-us-west-2.amazonaws.com/s.cdpn.io/382994/name-type.png");
      background-repeat: no-repeat;
      background-position: top 12px left 14px;
      border-radius: 50%;
    }

    .container .left .people {
      margin-left: -1px;
      border-right: 1px solid var(--light);
      border-left: 1px solid var(--light);
      width: calc(100% + 2px);
    }

    .container .left .people .person {
      position: relative;
      width: 100%;
      padding: 12px 10% 16px;
      cursor: pointer;
      background-color: var(--white);
    }

    .container .left .people .person:after {
      position: absolute;
      bottom: 0;
      left: 50%;
      display: block;
      width: 80%;
      height: 1px;
      content: "";
      background-color: var(--light);
      transform: translate(-50%, 0);
    }

    .container .left .people .person img {
      float: left;
      width: 40px;
      height: 40px;
      margin-right: 12px;
      border-radius: 50%;
      -o-object-fit: cover;
      object-fit: cover;
    }

    .container .left .people .person .name {
      font-size: 14px;
      line-height: 22px;
      color: var(--dark);
      font-family: "sofia-pro", sans-serif;
      font-weight: 600;
    }

    .container .left .people .person .time {
      font-size: 14px;
      position: absolute;
      top: 16px;
      right: 10%;
      padding: 0 0 5px 5px;
      color: var(--grey);
      background-color: var(--white);
    }

    .container .left .people .person .preview {
      font-size: 14px;
      display: inline-block;
      overflow: hidden !important;
      width: 70%;
      white-space: nowrap;
      text-overflow: ellipsis;
      color: var(--grey);
    }

    .container .left .people .person.active,
    .container .left .people .person:hover {
      margin-top: -1px;
      margin-left: -1px;
      padding-top: 13px;
      border: 0;
      background-color: var(--blue);
      width: calc(100% + 2px);
      padding-left: calc(10% + 1px);
    }

    .container .left .people .person.active span,
    .container .left .people .person:hover span {
      color: var(--white);
      background: transparent;
    }

    .container .left .people .person.active:after,
    .container .left .people .person:hover:after {
      display: none;
    }

    .container .right {
      position: relative;
      float: left;
      width: 62.4%;
      height: 100%;
    }

    .container .right .top {
      width: 100%;
      height: 47px;
      padding: 15px 29px;
      background-color: #eceff1;
    }

    .container .right .top span {
      font-size: 15px;
      color: var(--grey);
    }

    .container .right .top span .name {
      color: var(--dark);
      font-family: "sofia-pro", sans-serif;
      font-weight: 600;
    }

    .container .right .chat {
      position: relative;
      display: none;
      overflow: hidden;
      padding: 0 35px 92px;
      border-width: 1px 1px 1px 0;
      border-style: solid;
      border-color: var(--light);
      height: calc(100% - 48px);
      justify-content: flex-end;
      flex-direction: column;
    }

    .container .right .chat.active-chat {
      display: block;
      display: flex;
    }

    .container .right .chat.active-chat .bubble {
      transition-timing-function: cubic-bezier(0.4, -0.04, 1, 1);
    }

    .container .right .chat.active-chat .bubble:nth-of-type(1) {
      -webkit-animation-duration: 0.15s;
      animation-duration: 0.15s;
    }

    .container .right .chat.active-chat .bubble:nth-of-type(2) {
      -webkit-animation-duration: 0.3s;
      animation-duration: 0.3s;
    }

    .container .right .chat.active-chat .bubble:nth-of-type(3) {
      -webkit-animation-duration: 0.45s;
      animation-duration: 0.45s;
    }

    .container .right .chat.active-chat .bubble:nth-of-type(4) {
      -webkit-animation-duration: 0.6s;
      animation-duration: 0.6s;
    }

    .container .right .chat.active-chat .bubble:nth-of-type(5) {
      -webkit-animation-duration: 0.75s;
      animation-duration: 0.75s;
    }

    .container .right .chat.active-chat .bubble:nth-of-type(6) {
      -webkit-animation-duration: 0.9s;
      animation-duration: 0.9s;
    }

    .container .right .chat.active-chat .bubble:nth-of-type(7) {
      -webkit-animation-duration: 1.05s;
      animation-duration: 1.05s;
    }

    .container .right .chat.active-chat .bubble:nth-of-type(8) {
      -webkit-animation-duration: 1.2s;
      animation-duration: 1.2s;
    }

    .container .right .chat.active-chat .bubble:nth-of-type(9) {
      -webkit-animation-duration: 1.35s;
      animation-duration: 1.35s;
    }

    .container .right .chat.active-chat .bubble:nth-of-type(10) {
      -webkit-animation-duration: 1.5s;
      animation-duration: 1.5s;
    }

    .container .right .write {
      position: absolute;
      bottom: 29px;
      left: 30px;
      height: 42px;
      padding-left: 8px;
      border: 1px solid var(--light);
      background-color: #eceff1;
      width: calc(100% - 58px);
      border-radius: 5px;
    }

    .container .right .write input {
      font-size: 16px;
      float: left;
      width: 347px;
      height: 40px;
      padding: 0 10px;
      color: var(--dark);
      border: 0;
      outline: none;
      background-color: #eceff1;
      font-family: "sofia-pro", sans-serif;
      font-weight: 400;
    }

    .container .right .write .write-link.attach:before {
      display: inline-block;
      float: left;
      width: 20px;
      height: 42px;
      content: "";
      background-image: url("https://s3-us-west-2.amazonaws.com/s.cdpn.io/382994/attachment.png");
      background-repeat: no-repeat;
      background-position: center;
    }

    .container .right .write .write-link.smiley:before {
      display: inline-block;
      float: left;
      width: 20px;
      height: 42px;
      content: "";
      background-image: url("https://s3-us-west-2.amazonaws.com/s.cdpn.io/382994/smiley.png");
      background-repeat: no-repeat;
      background-position: center;
    }

    .container .right .write .write-link.send:before {
      display: inline-block;
      float: left;
      width: 20px;
      height: 42px;
      margin-left: 11px;
      content: "";
      background-image: url("https://s3-us-west-2.amazonaws.com/s.cdpn.io/382994/send.png");
      background-repeat: no-repeat;
      background-position: center;
    }

    .container .right .bubble {
      font-size: 16px;
      position: relative;
      display: inline-block;
      clear: both;
      margin-bottom: 8px;
      padding: 13px 14px;
      vertical-align: top;
      border-radius: 5px;
    }

    .container .right .bubble:before {
      position: absolute;
      top: 19px;
      display: block;
      width: 8px;
      height: 6px;
      content: " ";
      transform: rotate(29deg) skew(-35deg);
    }

    .container .right .bubble.you {
      float: left;
      color: var(--white);
      background-color: var(--blue);
      align-self: flex-start;
      -webkit-animation-name: slideFromLeft;
      animation-name: slideFromLeft;
    }

    .container .right .bubble.you:before {
      left: -3px;
      background-color: var(--blue);
    }

    .container .right .bubble.me {
      float: right;
      color: var(--dark);
      background-color: #eceff1;
      align-self: flex-end;
      -webkit-animation-name: slideFromRight;
      animation-name: slideFromRight;
    }

    .container .right .bubble.me:before {
      right: -3px;
      background-color: #eceff1;
    }

    .container .right .conversation-start {
      position: relative;
      width: 100%;
      margin-bottom: 27px;
      text-align: center;
    }

    .container .right .conversation-start span {
      font-size: 14px;
      display: inline-block;
      color: var(--grey);
    }

    .container .right .conversation-start span:before,
    .container .right .conversation-start span:after {
      position: absolute;
      top: 10px;
      display: inline-block;
      width: 30%;
      height: 1px;
      content: "";
      background-color: var(--light);
    }

    .container .right .conversation-start span:before {
      left: 0;
    }

    .container .right .conversation-start span:after {
      right: 0;
    }

    @keyframes slideFromLeft {
      0% {
        margin-left: -200px;
        opacity: 0;
      }

      100% {
        margin-left: 0;
        opacity: 1;
      }
    }

    @-webkit-keyframes slideFromLeft {
      0% {
        margin-left: -200px;
        opacity: 0;
      }

      100% {
        margin-left: 0;
        opacity: 1;
      }
    }

    @keyframes slideFromRight {
      0% {
        margin-right: -200px;
        opacity: 0;
      }

      100% {
        margin-right: 0;
        opacity: 1;
      }
    }

    @-webkit-keyframes slideFromRight {
      0% {
        margin-right: -200px;
        opacity: 0;
      }

      100% {
        margin-right: 0;
        opacity: 1;
      }
    }
  </style>
</head>

<body onload="getUserInfo()">
  <nav class="navbar navbar-expand navbar-light bg-light" style="background-color: white !important;">
    <div id="online" style="display: none;" class="online-indicator">
      <span class="blink mr-2"></span>
    </div>
    <span class="navbar-brand">Cosmic AzLearn</span>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" id="url" target="_blank" href="#"></a>
        </li>
      </ul>      
    </div>
  </nav>
  <div class="modal fade" id="inputName" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Please input your name</h5>
        </div>
        <div class="modal-body">
          <input id="username" class="form-control" type="text" placeholder="Your name" v-model="name"
            v-on:keypress.enter="setName">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" v-bind:disabled="!name" data-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>
  <div style="overflow: hidden;">
    <div id="globeView" class="col"></div>
    <div id="chatView" class="col">
      <div class="wrapper">
        <div class="container">
          <div class="left">
            <div class="top">
              <input type="text" placeholder="Search" />
              <a href="javascript:;" class="search"></a>
            </div>
            <ul class="people">
              <li class="person" data-chat="person1">
                <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/382994/thomas.jpg" alt="" />
                <span class="name">Thomas Bangalter</span>
                <span class="time">2:09 PM</span>
                <span class="preview">I was wondering...</span>
              </li>
              <li class="person" data-chat="person2">
                <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/382994/dog.png" alt="" />
                <span class="name">Dog Woofson</span>
                <span class="time">1:44 PM</span>
                <span class="preview">I've forgotten how it felt before</span>
              </li>
              <li class="person" data-chat="person3">
                <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/382994/louis-ck.jpeg" alt="" />
                <span class="name">Louis CK</span>
                <span class="time">2:09 PM</span>
                <span class="preview">But we’re probably gonna need a new carpet.</span>
              </li>
              <li class="person" data-chat="person4">
                <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/382994/bo-jackson.jpg" alt="" />
                <span class="name">Bo Jackson</span>
                <span class="time">2:09 PM</span>
                <span class="preview">It’s not that bad...</span>
              </li>
              <li class="person" data-chat="person5">
                <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/382994/michael-jordan.jpg" alt="" />
                <span class="name">Michael Jordan</span>
                <span class="time">2:09 PM</span>
                <span class="preview">Wasup for the third time like is
                  you blind bitch</span>
              </li>
              <li class="person" data-chat="person6">
                <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/382994/drake.jpg" alt="" />
                <span class="name">Drake</span>
                <span class="time">2:09 PM</span>
                <span class="preview">howdoyoudoaspace</span>
              </li>
            </ul>
          </div>
          <div class="right">
            <div class="top"><span>To: <span class="name">Dog Woofson</span></span></div>
            <div class="chat" data-chat="person1">
              <div style="overflow-y: scroll;height: 400px;">
                <div class="conversation-start">
                  <span>Today, 6:48 AM</span>
                </div>
                <div class="bubble you">
                  Hello,
                </div>
                <div class="bubble you">
                  it's me.
                </div>
                <div class="bubble you">
                  I was wondering...
                </div>
              </div>
            </div>
            <div class="chat" data-chat="person2">
              <div style="overflow-y: scroll;height: 400px;">
                <div class="conversation-start">
                  <span>Today, 5:38 PM</span>
                </div>
                <div class="bubble you">
                  Hello, can you hear me?
                </div>
                <div class="bubble you">
                  I'm in California dreaming
                </div>
                <div class="bubble me">
                  ... about who we used to be.
                </div>
                <div class="bubble me">
                  Are you serious?
                </div>
                <div class="bubble you">
                  When we were younger and free...
                </div>
                <div class="bubble you">
                  I've forgotten how it felt before
                </div>
              </div>
            </div>
            <div class="chat" data-chat="person3">
              <div class="conversation-start">
                <span>Today, 3:38 AM</span>
              </div>
              <div class="bubble you">
                Hey human!
              </div>
              <div class="bubble you">
                Umm... Someone took a shit in the hallway.
              </div>
              <div class="bubble me">
                ... what.
              </div>
              <div class="bubble me">
                Are you serious?
              </div>
              <div class="bubble you">
                I mean...
              </div>
              <div class="bubble you">
                It’s not that bad...
              </div>
              <div class="bubble you">
                But we’re probably gonna need a new carpet.
              </div>
            </div>
            <div class="chat" data-chat="person4">
              <div class="conversation-start">
                <span>Yesterday, 4:20 PM</span>
              </div>
              <div class="bubble me">
                Hey human!
              </div>
              <div class="bubble me">
                Umm... Someone took a shit in the hallway.
              </div>
              <div class="bubble you">
                ... what.
              </div>
              <div class="bubble you">
                Are you serious?
              </div>
              <div class="bubble me">
                I mean...
              </div>
              <div class="bubble me">
                It’s not that bad...
              </div>
            </div>
            <div class="chat" data-chat="person5">
              <div class="conversation-start">
                <span>Today, 6:28 AM</span>
              </div>
              <div class="bubble you">
                Wasup
              </div>
              <div class="bubble you">
                Wasup
              </div>
              <div class="bubble you">
                Wasup for the third time like is <br />you blind bitch
              </div>

            </div>
            <div class="chat" data-chat="person6">
              <div class="conversation-start">
                <span>Monday, 1:27 PM</span>
              </div>
              <div class="bubble you">
                So, how's your new phone?
              </div>
              <div class="bubble you">
                You finally have a smartphone :D
              </div>
              <div class="bubble me">
                Drake?
              </div>
              <div class="bubble me">
                Why aren't you answering?
              </div>
              <div class="bubble you">
                howdoyoudoaspace
              </div>
            </div>
            <div class="write">
              <a href="javascript:;" class="write-link attach"></a>
              <input type="text" />
              <a href="javascript:;" class="write-link smiley"></a>
              <a href="javascript:;" class="write-link send"></a>
            </div>
          </div>
          <div class="container" style="width:100%;left:160%">
            <div style="
            margin-top: -84%;
            float: left;
            height: 94%;
            width: 100%;
        ">
              <div class="todoContainer">
                <div class="todo-items-wrapper">
                  <div class="match">
                    <div class="match-header">
                      <div class="match-status">Live</div>
                      <div class="match-tournament"><img src="cosmosdb.svg" />CosmosPark
                        Premier League</div>
                      <div class="match-actions">
                        <div class="timer"></div>
                      </div>
                    </div>
                  </div>
                  <div class="todo-items">
                    <div class="todo-item">
                      <div class="check">
                        <div class="check-mark checked">
                          <img src="icon-check.svg">
                        </div>
                      </div>
                      <div class="todo-text checked">
                        Cut the lawn
                      </div>
                      <span style="color: #56b439;float:right;display:flex;align-items: center;">+2 Points</span>
                    </div>
                    <div class="todo-item">
                      <div class="check">
                        <div class="check-mark">

                        </div>
                      </div>
                      <div class="todo-text">
                        Cut the lawn
                      </div>
                    </div>
                    <div class="todo-item">
                      <div class="check">
                        <div class="check-mark">
                        </div>
                      </div>
                      <div class="todo-text">
                        Cut the lawn
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="leaderboard" style="
            margin-top: -50%;
            float: left;
            height: 75%;
            width: 100%;">
              <header>
                <h1>CosmosPark Leader Board</h1>
                <img src="cosmosdb.svg" alt="" style="height: 10rem;
                position: absolute;
                bottom: 0;
                right: 1rem;">
                <nav>
                  <a href="" class="active">7-days</a>
                  <a href="">30-days</a>
                  <a href="">All time</a>
                </nav>
              </header>
              <div style="overflow-y: scroll;height: 193px;">
                <table>
                  <thead>
                    <tr>
                      <th class="rank"></th>
                      <th class="nick">Name</th>
                      <th class="sp">Score</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="rank">1</td>
                      <td class="nick">Sc0utOP</td>
                      <td class="sp">6.308</td>
                    </tr>
                    <tr>
                      <td class="rank">2</td>
                      <td class="nick">MortaL</td>
                      <td class="sp">6.301</td>
                    </tr>
                    <tr>
                      <td class="rank">4</td>
                      <td class="nick">CarryMinati</td>
                      <td class="sp">5.108</td>
                    </tr>
                    <tr>
                      <td class="rank">5</td>
                      <td class="nick">CarryMinati</td>
                      <td class="sp">5.108</td>
                    </tr>
                    <tr>
                      <td class="rank">6</td>
                      <td class="nick">CarryMinati</td>
                      <td class="sp">5.108</td>

                    </tr>
                    <tr>
                      <td class="rank">7</td>
                      <td class="nick">CarryMinati</td>
                      <td class="sp">5.108</td>
                    </tr>
                    <tr>
                      <td class="rank">8</td>
                      <td class="nick">CarryMinati</td>
                      <td class="sp">5.108</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
  <script>
    class Timer {
      constructor(root) {
        root.innerHTML = Timer.getHTML();

        this.el = {
          minutes: root.querySelector(".timer__part--minutes"),
          seconds: root.querySelector(".timer__part--seconds"),
          control: root.querySelector(".timer__btn--control"),
          reset: root.querySelector(".timer__btn--reset")
        };

        this.interval = null;
        this.remainingSeconds = 60 * 60;
        this.start();
      }

      updateInterfaceTime() {
        const minutes = Math.floor(this.remainingSeconds / 60);
        const seconds = this.remainingSeconds % 60;

        this.el.minutes.textContent = minutes.toString().padStart(2, "0");
        this.el.seconds.textContent = seconds.toString().padStart(2, "0");
      }


      start() {
        if (this.remainingSeconds === 0) return;

        this.interval = setInterval(() => {
          this.remainingSeconds--;
          this.updateInterfaceTime();

          if (this.remainingSeconds === 0) {
            this.stop();
          }
        }, 1000);

      }

      stop() {
        clearInterval(this.interval);

        this.interval = null;

      }

      static getHTML() {
        return `
			<span class="timer__part timer__part--minutes">00</span>
			<span class="timer__part">:</span>
			<span class="timer__part timer__part--seconds">00</span>		
		`;
      }
    }

    new Timer(
      document.querySelector(".timer")
    );
    document.querySelector('.chat[data-chat=person2]').classList.add('active-chat')
    document.querySelector('.person[data-chat=person2]').classList.add('active')

    let friends = {
      list: document.querySelector('ul.people'),
      all: document.querySelectorAll('.left .person'),
      name: ''
    },
      chat = {
        container: document.querySelector('.container .right'),
        current: null,
        person: null,
        name: document.querySelector('.container .right .top .name')
      }

    friends.all.forEach(f => {
      f.addEventListener('mousedown', () => {
        f.classList.contains('active') || setAciveChat(f)
      })
    });

    function setAciveChat(f) {
      friends.list.querySelector('.active').classList.remove('active')
      f.classList.add('active')
      chat.current = chat.container.querySelector('.active-chat')
      chat.person = f.getAttribute('data-chat')
      chat.current.classList.remove('active-chat')
      chat.container.querySelector('[data-chat="' + chat.person + '"]').classList.add('active-chat')
      friends.name = f.querySelector('.name').innerText
      chat.name.innerHTML = friends.name
    }
  </script>
  <script>

    var SpeechSDK;
    var recognizer;
    var speechDisplayArea = document.getElementById('speechDisplayArea');
    var editorDisplayArea = document.getElementById('editor');
    var speechRecognizedText = "";
    let webSocket;
    let sessionId;
    var map, geolocationControl, currentUser;

    // Set the options that I want
    toastr.options = {
      "closeButton": true,
      "newestOnTop": false,
      "progressBar": true,
      "positionClass": "toast-bottom-center",
      "preventDuplicates": false,
      "onclick": null,
      "showDuration": "300",
      "hideDuration": "1000",
      "timeOut": "5000",
      "extendedTimeOut": "1000",
      "showEasing": "swing",
      "hideEasing": "linear",
      "showMethod": "fadeIn",
      "hideMethod": "fadeOut"
    }
    function setMapToUserLocation() {
      navigator.geolocation.getCurrentPosition(function (position) {

        console.log("latitude", position.coords.latitude);
        console.log("longitude", position.coords.longitude);

        var latitude = position.coords.latitude;
        var longitude = position.coords.longitude;


        map.setCamera({
          center: [position.coords.longitude, position.coords.latitude],
          zoom: 10
        })


        upsertUser(latitude, longitude);
      }, function (error) {
        switch (error.code) {
          case error.PERMISSION_DENIED:
            alert('User denied the request for geolocation.');
            break;
          case error.POSITION_UNAVAILABLE:
            alert('Position information is unavailable.');
            break;
          case error.TIMEOUT:
            alert('The request to get user position timed out.');
            break;
          case error.UNKNOWN_ERROR:
            alert('An unknown error occurred.');
            break;
        }
      });
      return false;
    }

    function updateStatus(status) {
      var onlineDiv = document.getElementById('online');
      if (status == 'Connected')
        onlineDiv.style.display = "block";
      else
        onlineDiv.style.display = "none";
    }

    async function initialize(url, isSpeaker) {

      let res = await fetch(url);
      let data = await res.json();
      updateStreamId(data.id);
      sessionId = data.id;

      let ws = new WebSocket(data.url, 'json.webpubsub.azure.v1');
      webSocket = ws;
      let editor = createEditor(document.querySelector('#editor'), true);

      if (isSpeaker) {
        let speechTokenData = await fetch('/speech-token');
        let response = await speechTokenData.json();
        let token = response.token;


        let speechConfig = SpeechSDK.SpeechConfig.fromAuthorizationToken(token, response.region);
        speechConfig.SpeechRecognitionLanguage = "en-US";


        var audioConfig = SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();
        recognizer = new SpeechSDK.SpeechRecognizer(speechConfig, audioConfig);

        recognizer.recognizing = recognizerCallback.bind(this);

        recognizer.recognized = holdRecognized.bind(this);

        recognizer.startContinuousRecognitionAsync();

      }

      return [ws, editor, data.id];
    }


    function holdRecognized(s, e) {
      speechRecognizedText += e.result.text != undefined ? e.result.text + "\r\n" : "";
      speechDisplayArea.value = speechRecognizedText;
    }

    function recognizerCallback(s, e) {
      speechDisplayArea.value = e.result.text != undefined ? speechRecognizedText + " " + e.result.text : speechRecognizedText;
      speechDisplayArea.scrollTop = speechDisplayArea.scrollHeight;
      webSocket.send(JSON.stringify({
        type: 'sendToGroup',
        group: sessionId,
        dataType: 'json',
        data: {
          type: 'speech',
          content: speechDisplayArea.value
        }
      }));
    };

    function joinGroup(ws, group) {
      ws.send(JSON.stringify({
        type: 'joinGroup',
        group: group,
        ackId: 1
      }));
    }

    function sendToGroup(ws, group, data) {
      ws.send(JSON.stringify({
        type: 'sendToGroup',
        group: group,
        dataType: 'json',
        data: data
      }));
    }

    function stopStream() {
      recognizer.stopContinuousRecognitionAsync(function () {
        recognizer.close();
        recognizer = undefined;
      }, function (err) {
        recognizer.close();
        recognizer = undefined;
      })
    }

    async function startStream() {
      let [ws, editor, id] = await initialize('/negotiate', true);
      let changes = [];
      let content = '';
      let version = 0;
      function flush() {
        if (changes.length === 0) return;
        sendToGroup(ws, id, {
          type: 'delta',
          version: version++,
          changes: changes
        });
        changes = [];
        content = editor.getValue();
      }

      setTimeout(ws.onopen = () => {
        updateStatus('Connected');
        setInterval(() => flush(), 200);
        joinGroup(ws, `${id}-control`);
        editor.on('change', e => changes.push(e));
        editor.setReadOnly(false);
      }, 1000);

      ws.onmessage = e => {
        let data = JSON.parse(e.data);
        if (data.data === 'sync') sendToGroup(ws, id, {
          type: 'full',
          version: version,
          content: content
        });
      }
    }

    async function onStartSession() {
      document.getElementById('startBtn').disabled = true;
      document.getElementById('stopBtn').disabled = false;
      speechDisplayArea.style.display = "block";
      editorDisplayArea.style.display = "block";
      startStream();
    }

    async function onJoinSession() {
      document.getElementById('joinBtn').disabled = true;
      document.getElementById('leaveBtn').disabled = false;
      speechDisplayArea.style.display = "block";
      editorDisplayArea.style.display = "block";
      updateStatus('Connected');
      watch(location.hash.slice(1));
    }

    async function onLeaveSession() {
      document.getElementById('joinBtn').disabled = true;
      document.getElementById('leaveBtn').disabled = false;
      speechDisplayArea.style.display = "none";
      editorDisplayArea.style.display = "none";
      updateStatus('Disconnected');
    }

    async function onStopSession() {
      document.getElementById('startBtn').disabled = false;
      document.getElementById('stopBtn').disabled = true;
      speechDisplayArea.style.display = "none";
      editorDisplayArea.style.display = "none";
      updateStatus('Disconnected');
      stopStream();
    }

    async function watch(id) {
      let version = -1;
      let [ws, editor] = await initialize(`/negotiate?id=${id}`, false)
      ws.onopen = () => {
        joinGroup(ws, id);
      };

      ws.onmessage = e => {
        let data = JSON.parse(e.data);
        if (data.type === 'ack' && data.success) sendToGroup(ws, `${id}-control`, 'sync');
        else if (data.type === 'message') {
          switch (data.data.type) {
            case 'delta':
              if (data.data.version !== version + 1)
                data.data.changes.forEach(c => editor.getSession().getDocument().applyDelta(c));
              version = data.data.version;
              break;
            case 'full':
              if (version >= data.data.version) break;
              editor.setValue(data.data.content);
              version = data.data.version;
              break;
            case 'speech':
              if (version >= data.data.version) break;
              speechDisplayArea.value = data.data.content;
              speechDisplayArea.scrollTop = speechDisplayArea.scrollHeight;
              version = data.data.version;
              break;
          }
        }
      }
    }


    async function upsertUser(latitude, longitude) {
      const response = await fetch('/api/azMap/addressLookup/' + latitude + '/' + longitude);
      const addressLookup = await response.json();

      console.log('address lookup', addressLookup);
      var userResponse = await getUserById(addressLookup.addresses[0].address.countryCode, currentUser.clientPrincipal.userId);

      console.log(userResponse);
      console.log("create/update user");

      await fetch('/api/user', {
        method: "POST",
        body: JSON.stringify({
          identityProvider: currentUser.clientPrincipal.identityProvider,
          id: currentUser.clientPrincipal.userId,
          name: currentUser.clientPrincipal.userDetails,
          roles: currentUser.clientPrincipal.userRoles,
          address: {
            name: addressLookup.addresses[0].address.freeformAddress,
            country: {
              code: addressLookup.addresses[0].address.countryCode,
              subDivision: addressLookup.addresses[0].address.countrySubdivision,
              secondarySubDivision: addressLookup.addresses[0].address.countrySecondarySubdivision,
              isoCode3: addressLookup.addresses[0].address.countryCodeISO3
            },
            street: {
              name: addressLookup.addresses[0].address.streetName,
              nameAndNumber: addressLookup.addresses[0].address.streetNameAndNumber
            },
            position: {
              latitude: latitude,
              longitude: longitude
            }
          }
        })
      });


      //update markers

      await updateMapMarkers(addressLookup.addresses[0].address.countryCode);

      //get websocket connection
      var connection = await fetch('/api/pubsub/connection');
      let data = await connection.json();
      console.log(data.url);

      let ws = new WebSocket(data.url, 'json.webpubsub.azure.v1');
      webSocket = ws;

      setTimeout(ws.onopen = () => {
        updateStatus('Connected');
        joinGroup(ws, `global-location`);
      }, 1000);

      ws.onmessage = async (e) => {
        let data = JSON.parse(e.data);

        if (data.from == "group")
          await updateMapMarkers(addressLookup.addresses[0].address.countryCode);

        if (data.from == "group" && data.data.userId != currentUser.clientPrincipal.userId) {
          console.log(data.from);
          console.log(data.data.userId);
          console.log(currentUser.clientPrincipal.userId);
          toastr.success("" + data.data.userName + " is online from " + data.data.city + "," + data.data.state);
        }

        console.log("websocket message", data);
      }
    }


    async function getUserInfo() {
      const response = await fetch('/.auth/me');
      currentUser = await response.json();
      console.log(currentUser);

      if (currentUser == null || currentUser.clientPrincipal == null) {
        window.location.href = "/.auth/login/github"
      }
      else {
        map = new atlas.Map("globeView", {
          authOptions: {
            authType: 'subscriptionKey',
            subscriptionKey: '4c5wlP9ya7T5Eq_CJ3ooOx_4HRON8SWdO6Bo4-1wj0g',
          },
          style: "grayscale_light",
          center: [78.8718, 21.7679],
          zoom: 3.5
        });

        map.events.add('ready', function () {
          map.controls.add([
            new atlas.control.StyleControl(),
            new atlas.control.GeolocationControl({
              style: 'auto'
            })
          ], {
            position: 'top-right'
          });
        });

        setTimeout(setMapToUserLocation, 1000);
      }
    }

    async function updateMapMarkers(countryCode) {
      let responseUsers = await getAllUsers(countryCode)
      let locations = await responseUsers.json();

      map.markers.clear();

      var cosmosParkTemplate = {
        title: '{name}',
        content: '<div>' +
          '<button id="startBtn" onclick="addChat({name})" type="button" style=" color: #fff;background-color: #20ad00;border-color: #20ad00;">Chat</button>' +
          '<\div>',
        singleDescription: false,
        numberFormat: {
          maximumFractionDigits: 2
        },

        //Since we trust the data being retrieve, don't sandbox the content so that we can use CSS classes.
        sandboxContent: true
      };

      locations.forEach(element => {
        console.log(element);
        var marker = new atlas.HtmlMarker({
          htmlContent: "<div><div class='pin'></div><div class='pulse'></div></div>",
          position: [element.address.position.longitude, element.address.position.latitude],
          popup: new atlas.Popup({
            content: '<div style="padding:20px;">' +
              '<div> <span>' + element.name + '</span></div>' +
              '<button id="startBtn" onclick="addChat(\'' + element.id + '\')" type="button" style=" color: #fff;background-color: #20ad00;border-color: #20ad00;margin-top:10px">Chat</button>' +
              '<\div>'
          })
        });
        console.log(marker);
        map.events.add('click', marker, () => {
          marker.togglePopup();
        });
        map.markers.add(marker);
      });
    }
    function addChat(name) {
      console.log(name);
    }

    async function getUserById(countryCode, userId) {
      const response = await fetch('/api/user/' + userId + '/' + userId);
      return response;
    }

    async function getAllUsers() {
      const response = await fetch('/api/users');
      return response;
    }

    if (!!window.SpeechSDK) {
      SpeechSDK = window.SpeechSDK;
    }    
  </script>
</body>

</html>